# Comparing `tmp/rttbackend-0.3-cp39-cp39-manylinux_2_17_x86_64.manylinux2014_x86_64.manylinux_2_24_x86_64.whl.zip` & `tmp/rttbackend-0.3.2-cp39-cp39-manylinux_2_17_x86_64.manylinux2014_x86_64.manylinux_2_24_x86_64.whl.zip`

## zipinfo {}

```diff
@@ -1,23 +1,23 @@
-Zip file size: 285741 bytes, number of entries: 21
-drwxr-xr-x  2.0 unx        0 b- stor 23-Jun-25 08:14 rttbackend-0.3.dist-info/
-drwxr-xr-x  2.0 unx        0 b- stor 23-Jun-25 08:14 rttbackend/
-drwxr-xr-x  2.0 unx        0 b- stor 23-Jun-25 08:14 rttbackend.libs/
--rw-r--r--  2.0 unx      892 b- defN 23-Jun-25 08:14 rttbackend-0.3.dist-info/METADATA
--rw-rw-r--  2.0 unx     1327 b- defN 23-Jun-25 08:14 rttbackend-0.3.dist-info/RECORD
--rw-r--r--  2.0 unx       11 b- defN 23-Jun-25 08:14 rttbackend-0.3.dist-info/top_level.txt
--rw-r--r--  2.0 unx      185 b- defN 23-Jun-25 08:14 rttbackend-0.3.dist-info/WHEEL
-drwxr-xr-x  2.0 unx        0 b- stor 23-Jun-25 08:14 rttbackend/exchanges/
-drwxr-xr-x  2.0 unx        0 b- stor 23-Jun-25 08:14 rttbackend/backends/
--rw-r--r--  2.0 unx     1724 b- defN 23-Jun-25 08:14 rttbackend/symbols.py
--rwxr-xr-x  2.0 unx  1036480 b- defN 23-Jun-25 08:14 rttbackend/types.cpython-39-x86_64-linux-gnu.so
--rw-r--r--  2.0 unx     2651 b- defN 23-Jun-25 08:14 rttbackend/config.py
--rw-r--r--  2.0 unx     6737 b- defN 23-Jun-25 08:14 rttbackend/exchange.py
--rw-r--r--  2.0 unx     2339 b- defN 23-Jun-25 08:14 rttbackend/connection.py
--rw-r--r--  2.0 unx        0 b- defN 23-Jun-25 08:14 rttbackend/__init__.py
--rw-r--r--  2.0 unx      718 b- defN 23-Jun-25 08:14 rttbackend/exceptions.py
--rw-r--r--  2.0 unx      230 b- defN 23-Jun-25 08:14 rttbackend/defines.py
--rw-r--r--  2.0 unx     2275 b- defN 23-Jun-25 08:14 rttbackend/exchanges/alphavantage.py
--rw-r--r--  2.0 unx      334 b- defN 23-Jun-25 08:14 rttbackend/exchanges/__init__.py
--rw-r--r--  2.0 unx     3398 b- defN 23-Jun-25 08:14 rttbackend/backends/postgres.py
--rw-r--r--  2.0 unx        0 b- defN 23-Jun-25 08:14 rttbackend/backends/__init__.py
-21 files, 1059301 bytes uncompressed, 283011 bytes compressed:  73.3%
+Zip file size: 285911 bytes, number of entries: 21
+drwxr-xr-x  2.0 unx        0 b- stor 23-Jun-27 11:53 rttbackend-0.3.2.dist-info/
+drwxr-xr-x  2.0 unx        0 b- stor 23-Jun-27 11:53 rttbackend/
+drwxr-xr-x  2.0 unx        0 b- stor 23-Jun-27 11:53 rttbackend.libs/
+-rw-r--r--  2.0 unx      916 b- defN 23-Jun-27 11:53 rttbackend-0.3.2.dist-info/METADATA
+-rw-rw-r--  2.0 unx     1335 b- defN 23-Jun-27 11:53 rttbackend-0.3.2.dist-info/RECORD
+-rw-r--r--  2.0 unx       11 b- defN 23-Jun-27 11:53 rttbackend-0.3.2.dist-info/top_level.txt
+-rw-r--r--  2.0 unx      185 b- defN 23-Jun-27 11:53 rttbackend-0.3.2.dist-info/WHEEL
+drwxr-xr-x  2.0 unx        0 b- stor 23-Jun-27 11:53 rttbackend/exchanges/
+drwxr-xr-x  2.0 unx        0 b- stor 23-Jun-27 11:53 rttbackend/backends/
+-rw-r--r--  2.0 unx     1724 b- defN 23-Jun-27 11:53 rttbackend/symbols.py
+-rwxr-xr-x  2.0 unx  1036480 b- defN 23-Jun-27 11:53 rttbackend/types.cpython-39-x86_64-linux-gnu.so
+-rw-r--r--  2.0 unx     2651 b- defN 23-Jun-27 11:53 rttbackend/config.py
+-rw-r--r--  2.0 unx     6737 b- defN 23-Jun-27 11:53 rttbackend/exchange.py
+-rw-r--r--  2.0 unx     2339 b- defN 23-Jun-27 11:53 rttbackend/connection.py
+-rw-r--r--  2.0 unx        0 b- defN 23-Jun-27 11:53 rttbackend/__init__.py
+-rw-r--r--  2.0 unx      718 b- defN 23-Jun-27 11:53 rttbackend/exceptions.py
+-rw-r--r--  2.0 unx      273 b- defN 23-Jun-27 11:53 rttbackend/defines.py
+-rw-r--r--  2.0 unx     2269 b- defN 23-Jun-27 11:53 rttbackend/exchanges/alphavantage.py
+-rw-r--r--  2.0 unx      334 b- defN 23-Jun-27 11:53 rttbackend/exchanges/__init__.py
+-rw-r--r--  2.0 unx     4073 b- defN 23-Jun-27 11:53 rttbackend/backends/postgres.py
+-rw-r--r--  2.0 unx        0 b- defN 23-Jun-27 11:53 rttbackend/backends/__init__.py
+21 files, 1060045 bytes uncompressed, 283161 bytes compressed:  73.3%
```

## zipnote {}

```diff
@@ -1,26 +1,26 @@
-Filename: rttbackend-0.3.dist-info/
+Filename: rttbackend-0.3.2.dist-info/
 Comment: 
 
 Filename: rttbackend/
 Comment: 
 
 Filename: rttbackend.libs/
 Comment: 
 
-Filename: rttbackend-0.3.dist-info/METADATA
+Filename: rttbackend-0.3.2.dist-info/METADATA
 Comment: 
 
-Filename: rttbackend-0.3.dist-info/RECORD
+Filename: rttbackend-0.3.2.dist-info/RECORD
 Comment: 
 
-Filename: rttbackend-0.3.dist-info/top_level.txt
+Filename: rttbackend-0.3.2.dist-info/top_level.txt
 Comment: 
 
-Filename: rttbackend-0.3.dist-info/WHEEL
+Filename: rttbackend-0.3.2.dist-info/WHEEL
 Comment: 
 
 Filename: rttbackend/exchanges/
 Comment: 
 
 Filename: rttbackend/backends/
 Comment:
```

## rttbackend/defines.py

```diff
@@ -1,14 +1,16 @@
 
 ALPHAVANTAGE = 'ALPHAVANTAGE'
 QUANDL = 'QUANDL'
+POSTGRES = 'POSTGRES'
 
-# available methods
+# available methods / tables
 REFRESH_SYMBOL = 'REFRESH_SYMBOL'
-
 SYMBOL = 'SYMBOL'
 EXCHANGE = 'EXCHANGE'
 BASE_SYMBOL = 'BASE_SYMBOL'
 QUOTE_SYMBOL = 'QUOTE_SYMBOL'
 
+RAW = 'RAW'
+
 # db schema
 TABLE = 'tb_'
```

## rttbackend/exchanges/alphavantage.py

```diff
@@ -67,14 +67,14 @@
     def _refresh_symbol(self, msg, ts):
         data = []
         for j in msg:
             data.append(RefreshSymbols(
                 self.id, j['symbol'], j['base'], j['quote'], ts, raw=j))
         return data
 
-    async def message_handler(self, type, msg: str):
+    def message_handler(self, type, msg: str):
 
         msg = json.loads(msg, parse_float=Decimal)
 
         if type == REFRESH_SYMBOL:
             return self._refresh_symbol(msg, time())
```

## rttbackend/backends/postgres.py

```diff
@@ -1,78 +1,95 @@
 
 import asyncpg
 from typing import Tuple
-from rttbackend.defines import REFRESH_SYMBOL, TABLE, EXCHANGE, BASE_SYMBOL, QUOTE_SYMBOL, SYMBOL
+from rttbackend.defines import POSTGRES, REFRESH_SYMBOL, TABLE, EXCHANGE, BASE_SYMBOL, QUOTE_SYMBOL, SYMBOL, RAW
 from datetime import datetime as dt
-
+from rttbackend.config import Config
+import json
 
 class CredsPostgres():
     def __init__(self):
         pass
 
 
 class TargetPostgres(CredsPostgres):
-    host = '192.168.191.213'
-    user = 'postgres'
-    pw = 'password'
-    db = 'rtt-db'
-    port = 5432
+    id = POSTGRES
+    def __init__(self, config=None):
+        if config is None:
+            config = 'config.yaml'
+        
+        self.config = Config(config=config)
+        keys = self.config[self.id.lower()] 
+        self.host = keys.host
+        self.user = keys.user
+        self.pw = keys.pw
+        self.db = keys.db
+        self.port = keys.port
+        
 
 
 class Postgres():
     def __init__(self, conn: CredsPostgres):
         self.table = self.default_table
+        self.raw_table = TABLE + RAW
 
         self.host = conn.host
         self.user = conn.user
         self.pw = conn.pw
         self.db = conn.db
         self.port = conn.port
 
+
+    def _raw(self, data: Tuple):
+        timestamp, data = data
+        return f"('{timestamp}','{json.dumps(data)}')"
+    
     async def _connect(self):
         self.conn = await asyncpg.connect(user=self.user, password=self.pw, database=self.db, host=self.host, port=self.port)
 
     async def read(self):
         await self._connect()
         args_str = self._read()
         async with self.conn.transaction():
             try:
                 return await self.conn.fetch(f"SELECT {args_str} FROM {self.table}")
             except Exception as a:
                 print(a)
-                # when restarting a subscription, some exchanges will re-publish a few messages
+                  # when restarting a subscription, some exchanges will re-publish a few messages
                 pass
-
+     
     async def write(self, updates: list):
         await self._connect()
 
         batch = []
 
         for data in updates:
             data = data.to_dict()
             ts = dt.utcfromtimestamp(
                 data['timestamp']) if data['timestamp'] else None
             batch.append((ts, data))
-
+        
         args_str = ','.join([self._write(u) for u in batch])
+        args_raw_str = ','.join([self._raw(u) for u in batch])
 
         async with self.conn.transaction():
             try:
                 await self.conn.execute(f"INSERT INTO {self.table} VALUES {args_str} ON CONFLICT DO NOTHING")
+                await self.conn.execute(f"INSERT INTO {self.raw_table} VALUES {args_raw_str}")
             except Exception as a:
                 print(a)
                 # when restarting a subscription, some exchanges will re-publish a few messages
                 pass
 
 
 class RefreshSymbolPostgres(Postgres):
     default_table = TABLE + REFRESH_SYMBOL
 
     def _read(self):
-        return f"time,exchange,symbol,base_symbol,quote_symbol"
+        return f"timestamp,exchange,symbol,base_symbol,quote_symbol"
 
     def _write(self, data: Tuple):
 
         timestamp, data = data
         return f"('{timestamp}','{data['exchange']}','{data['symbol']}','{data['base_symbol']}','{data['quote_symbol']}')"
 
 
@@ -81,14 +98,15 @@
 
     def _read(self):
         return f"id,exchange"
 
     def _write(self, data: Tuple):
         timestamp, data = data
         return f"(DEFAULT,'{data['exchange']}','{timestamp}')"
+    
 
 
 class BaseSymbolPostgres(Postgres):
     default_table = TABLE + BASE_SYMBOL
 
     def _read(self):
         return f"id,base_symbol"
@@ -112,8 +130,9 @@
     default_table = TABLE + SYMBOL
 
     def _read(self):
         return NotImplemented
 
     def _write(self, data: Tuple):
         timestamp, data = data
-        return f"(DEFAULT, '{data['exchange_id']}', '{data['base_symbol_id']}', '{data['quote_symbol_id']}', '{data['symbol']}', '{timestamp}')"
+        return f"(DEFAULT, '{data['exchange_id']}', '{data['base_symbol_id']}', '{data['quote_symbol_id']}', '{data['symbol']}', '{timestamp}')"
+
```

## Comparing `rttbackend-0.3.dist-info/METADATA` & `rttbackend-0.3.2.dist-info/METADATA`

 * *Files 10% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: rttbackend
-Version: 0.3
+Version: 0.3.2
 Summary: realtimetrade backend service
 Home-page: https://github.com/liej6799/realtimetrade
 Author: Joes Lie
 Author-email: liej6799@protonmail.ch
 License: XFree86
 Classifier: Intended Audience :: Developers
 Classifier: Development Status :: 4 - Beta
@@ -16,16 +16,17 @@
 Requires-Python: >=3.8
 Description-Content-Type: text/markdown
 Requires-Dist: requests (>=2.18.4)
 Requires-Dist: websockets (>=10.0)
 Requires-Dist: pyyaml
 Requires-Dist: aiohttp (==3.8.4)
 Requires-Dist: aiofile (>=2.0.0)
-Requires-Dist: yapic.json (>=1.6.3)
+Requires-Dist: yapic.json
 Requires-Dist: asyncpg
+Requires-Dist: numpy (==1.24.4)
 Requires-Dist: uvloop ; platform_system != "Windows"
 
 
 
 ----
```

## Comparing `rttbackend-0.3.dist-info/RECORD` & `rttbackend-0.3.2.dist-info/RECORD`

 * *Files 12% similar despite different names*

```diff
@@ -1,16 +1,16 @@
-rttbackend-0.3.dist-info/METADATA,sha256=xINpnYs_y2jENA46wPyhmEAz45IGsc-rKjMGMES0vXg,892
-rttbackend-0.3.dist-info/RECORD,,
-rttbackend-0.3.dist-info/top_level.txt,sha256=7ew1Lc9wMpbhlk1cr-ob1tazc9OVRh2ffLYkA95jxxI,11
-rttbackend-0.3.dist-info/WHEEL,sha256=kME1sdla9K4T_7CWMh40G9-WCrXNZzLfawqzXFJn2ag,185
+rttbackend-0.3.2.dist-info/METADATA,sha256=NICU4VjflPh1Jq5VWlP7PIqy-xLOhq8lOd0aNS2EHbQ,916
+rttbackend-0.3.2.dist-info/RECORD,,
+rttbackend-0.3.2.dist-info/top_level.txt,sha256=7ew1Lc9wMpbhlk1cr-ob1tazc9OVRh2ffLYkA95jxxI,11
+rttbackend-0.3.2.dist-info/WHEEL,sha256=kME1sdla9K4T_7CWMh40G9-WCrXNZzLfawqzXFJn2ag,185
 rttbackend/symbols.py,sha256=4_O2IgLF6Q8IGIjfW8PnAMMaiFBIqRwAi3Qw1ESGRkY,1724
 rttbackend/types.cpython-39-x86_64-linux-gnu.so,sha256=3nZe_SG7YdS-Gki2waiNRdlg0oMslr37Lfeycggk_co,1036480
 rttbackend/config.py,sha256=u2-MvbK_fRTFvUijfypbLZ8_ivczwCsRneMg3fWKWYs,2651
 rttbackend/exchange.py,sha256=qfkPDt7dBCLudZR5MnJn7N08-rN0sCiXYZBF6XcrdnM,6737
 rttbackend/connection.py,sha256=eHB4PQ_Gp40AenJo6rWLw2ZSUbBe_JIRSdkpCKD1yk0,2339
 rttbackend/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
 rttbackend/exceptions.py,sha256=23NK4UfvM_FDNhJ3f4hIM3FgaDxSZgRU3BTMR_Li-vQ,718
-rttbackend/defines.py,sha256=nyKHQPwKV1t2q2ZSlCkZMkfxo6H_dtjZH5nYi9C9-gM,230
-rttbackend/exchanges/alphavantage.py,sha256=Fppp-yEIUjZliEUmwXUX7Gm4IxDEYqJd7dAy7_24GWk,2275
+rttbackend/defines.py,sha256=T6xOc-2eJl9LFPO0hDe8ZxhDp3tnH2x2SdMmg6Ploc4,273
+rttbackend/exchanges/alphavantage.py,sha256=btrdF5oPZwGe9KxJSaugA5aCMoEVmydTGiTTKUimyP0,2269
 rttbackend/exchanges/__init__.py,sha256=GiHtys6pWL-STHElBfkeSiLIvBRIDDnHPOdRBtIzpLI,334
-rttbackend/backends/postgres.py,sha256=Y8aUTl4Y8w_dnkmGOMW4812kl6e4NyYq7e0p7H9wNY0,3398
+rttbackend/backends/postgres.py,sha256=DCT6j0_Q9lx0Pro52j_rRuTx_8AbXiJh82QBTvpi9xU,4073
 rttbackend/backends/__init__.py,sha256=47DEQpj8HBSa-_TImW-5JCeuQeRkm5NMpJWZG3hSuFU,0
```

