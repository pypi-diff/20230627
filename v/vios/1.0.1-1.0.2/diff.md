# Comparing `tmp/vios-1.0.1-py3-none-any.whl.zip` & `tmp/vios-1.0.2-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,28 +1,25 @@
-Zip file size: 42952 bytes, number of entries: 26
--rw-rw-rw-  2.0 fat     3944 b- defN 23-May-29 01:06 vios/__init__.py
--rw-rw-rw-  2.0 fat     4867 b- defN 23-Jun-08 02:11 vios/collection/__init__.py
--rw-rw-rw-  2.0 fat     1913 b- defN 23-Jun-08 02:06 vios/collection/analyzer.py
--rw-rw-rw-  2.0 fat    11254 b- defN 23-Jun-08 02:06 vios/collection/experiment.py
--rw-rw-rw-  2.0 fat    11189 b- defN 23-Jun-12 00:16 vios/collection/qcloud.py
--rw-rw-rw-  2.0 fat     3527 b- defN 23-Jun-08 02:06 vios/collection/support.py
--rw-rw-rw-  2.0 fat    10232 b- defN 23-Jun-08 02:06 vios/collection/uapi.py
--rw-rw-rw-  2.0 fat     4756 b- defN 23-Jun-12 00:16 vios/driver/VirtualDevice.py
--rw-rw-rw-  2.0 fat     2962 b- defN 23-Jun-08 02:11 vios/driver/__init__.py
--rw-rw-rw-  2.0 fat      238 b- defN 23-Jun-08 02:11 vios/driver/common/__init__.py
--rw-rw-rw-  2.0 fat     4199 b- defN 23-Jun-08 02:11 vios/driver/common/basedriver.py
--rw-rw-rw-  2.0 fat     4666 b- defN 23-Jun-08 02:11 vios/driver/common/quantity.py
--rw-rw-rw-  2.0 fat    17014 b- defN 23-Jun-08 02:11 vios/driver/common/tek_seq_builder.py
--rw-rw-rw-  2.0 fat     1752 b- defN 23-Jun-08 02:11 vios/driver/common/utils.py
--rw-rw-rw-  2.0 fat     5546 b- defN 23-Jun-08 02:11 vios/driver/common/visadriver.py
--rw-rw-rw-  2.0 fat     1639 b- defN 23-Jun-08 02:11 vios/envelope/__init__.py
--rw-rw-rw-  2.0 fat    10536 b- defN 23-Jun-12 00:16 vios/envelope/calculator.py
--rw-rw-rw-  2.0 fat     2530 b- defN 23-Jun-12 00:16 vios/envelope/compiler.py
--rw-rw-rw-  2.0 fat     4066 b- defN 23-Jun-12 00:16 vios/envelope/demodulator.py
--rw-rw-rw-  2.0 fat     1047 b- defN 23-Mar-08 06:14 vios/envelope/device.py
--rw-rw-rw-  2.0 fat     4093 b- defN 23-Jun-08 02:11 vios/envelope/rule.py
--rw-rw-rw-  2.0 fat     1089 b- defN 23-Jun-12 04:00 vios-1.0.1.dist-info/LICENSE
--rw-rw-rw-  2.0 fat     1010 b- defN 23-Jun-12 04:00 vios-1.0.1.dist-info/METADATA
--rw-rw-rw-  2.0 fat       92 b- defN 23-Jun-12 04:00 vios-1.0.1.dist-info/WHEEL
--rw-rw-rw-  2.0 fat        5 b- defN 23-Jun-12 04:00 vios-1.0.1.dist-info/top_level.txt
-?rw-rw-r--  2.0 fat     2132 b- defN 23-Jun-12 04:00 vios-1.0.1.dist-info/RECORD
-26 files, 116298 bytes uncompressed, 39544 bytes compressed:  66.0%
+Zip file size: 33236 bytes, number of entries: 23
+-rw-rw-rw-  2.0 fat      781 b- defN 23-Jun-26 13:01 vios/__init__.py
+-rw-rw-rw-  2.0 fat     4936 b- defN 23-Jun-26 13:00 vios/collection/__init__.py
+-rw-rw-rw-  2.0 fat     3515 b- defN 23-Jun-26 11:28 vios/collection/support.py
+-rw-rw-rw-  2.0 fat    11254 b- defN 23-Jun-19 15:11 vios/collection/tasks.py
+-rw-rw-rw-  2.0 fat    10235 b- defN 23-Jun-26 11:28 vios/collection/uapi.py
+-rw-rw-rw-  2.0 fat     4756 b- defN 23-Jun-19 15:11 vios/driver/VirtualDevice.py
+-rw-rw-rw-  2.0 fat     2962 b- defN 23-Jun-19 15:11 vios/driver/__init__.py
+-rw-rw-rw-  2.0 fat      209 b- defN 23-Jun-26 11:28 vios/driver/common/__init__.py
+-rw-rw-rw-  2.0 fat     4199 b- defN 23-Jun-26 13:04 vios/driver/common/basedriver.py
+-rw-rw-rw-  2.0 fat     4666 b- defN 23-Jun-19 15:11 vios/driver/common/quantity.py
+-rw-rw-rw-  2.0 fat     5546 b- defN 23-Jun-19 15:11 vios/driver/common/visadriver.py
+-rw-rw-rw-  2.0 fat      784 b- defN 23-Jun-21 12:45 vios/envelope/__init__.py
+-rw-rw-rw-  2.0 fat    12840 b- defN 23-Jun-26 11:28 vios/envelope/assembler.py
+-rw-rw-rw-  2.0 fat    10541 b- defN 23-Jun-26 11:28 vios/envelope/calculator.py
+-rw-rw-rw-  2.0 fat     1047 b- defN 23-Jun-19 15:11 vios/envelope/device.py
+-rw-rw-rw-  2.0 fat     1719 b- defN 23-Jun-26 11:28 vios/envelope/processor.py
+-rw-rw-rw-  2.0 fat     2980 b- defN 23-Jun-26 12:50 vios/envelope/rule.py
+-rw-rw-rw-  2.0 fat      522 b- defN 23-Jun-26 11:28 vios/tools/__init__.py
+-rw-rw-rw-  2.0 fat     1089 b- defN 23-Jun-27 03:36 vios-1.0.2.dist-info/LICENSE
+-rw-rw-rw-  2.0 fat     1000 b- defN 23-Jun-27 03:36 vios-1.0.2.dist-info/METADATA
+-rw-rw-rw-  2.0 fat       92 b- defN 23-Jun-27 03:36 vios-1.0.2.dist-info/WHEEL
+-rw-rw-rw-  2.0 fat        5 b- defN 23-Jun-27 03:36 vios-1.0.2.dist-info/top_level.txt
+-rw-rw-r--  2.0 fat     1857 b- defN 23-Jun-27 03:36 vios-1.0.2.dist-info/RECORD
+23 files, 87535 bytes uncompressed, 30256 bytes compressed:  65.4%
```

## zipnote {}

```diff
@@ -1,23 +1,17 @@
 Filename: vios/__init__.py
 Comment: 
 
 Filename: vios/collection/__init__.py
 Comment: 
 
-Filename: vios/collection/analyzer.py
-Comment: 
-
-Filename: vios/collection/experiment.py
-Comment: 
-
-Filename: vios/collection/qcloud.py
+Filename: vios/collection/support.py
 Comment: 
 
-Filename: vios/collection/support.py
+Filename: vios/collection/tasks.py
 Comment: 
 
 Filename: vios/collection/uapi.py
 Comment: 
 
 Filename: vios/driver/VirtualDevice.py
 Comment: 
@@ -30,50 +24,47 @@
 
 Filename: vios/driver/common/basedriver.py
 Comment: 
 
 Filename: vios/driver/common/quantity.py
 Comment: 
 
-Filename: vios/driver/common/tek_seq_builder.py
-Comment: 
-
-Filename: vios/driver/common/utils.py
-Comment: 
-
 Filename: vios/driver/common/visadriver.py
 Comment: 
 
 Filename: vios/envelope/__init__.py
 Comment: 
 
-Filename: vios/envelope/calculator.py
+Filename: vios/envelope/assembler.py
 Comment: 
 
-Filename: vios/envelope/compiler.py
+Filename: vios/envelope/calculator.py
 Comment: 
 
-Filename: vios/envelope/demodulator.py
+Filename: vios/envelope/device.py
 Comment: 
 
-Filename: vios/envelope/device.py
+Filename: vios/envelope/processor.py
 Comment: 
 
 Filename: vios/envelope/rule.py
 Comment: 
 
-Filename: vios-1.0.1.dist-info/LICENSE
+Filename: vios/tools/__init__.py
+Comment: 
+
+Filename: vios-1.0.2.dist-info/LICENSE
 Comment: 
 
-Filename: vios-1.0.1.dist-info/METADATA
+Filename: vios-1.0.2.dist-info/METADATA
 Comment: 
 
-Filename: vios-1.0.1.dist-info/WHEEL
+Filename: vios-1.0.2.dist-info/WHEEL
 Comment: 
 
-Filename: vios-1.0.1.dist-info/top_level.txt
+Filename: vios-1.0.2.dist-info/top_level.txt
 Comment: 
 
-Filename: vios-1.0.1.dist-info/RECORD
+Filename: vios-1.0.2.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## vios/__init__.py

```diff
@@ -1,123 +1,20 @@
 # vios(Virtual Input and Output System)，主要定义设备驱动及执行流程，包含以下功能模块：
 
 # 一、driver：设备驱动
 #     1、所有驱动继承自BaseDriver，类名统一为Driver，并要求实现open/close/read/write四个方法。样板见VirtualDevice
 #     2、以设备或厂家为名新建文件夹（并于其内新建__init__.py文件）放于driver/common内，将厂家提供的底层库（若有）置于其内
 
-# 二、envelope：执行流程，见各模块开头的说明
+# 二、envelope：执行流程，见各模块说明
 
 # 三、collection：一些工具、函数、类或其他
 
-# 四、tutorial：使用示例，详见模块自身说明 
-
-
-import datetime
-import string
-import sys
-
-import numpy as np
-
-CLOUD = {'quafu': {'server': '124.70.54.59/qbackend',
-                   'token': "Ei60GCN4eIGAUE-doAsUW54A00CUfkR539x5LTxG-om.9RDOwkDM1cDO2EjOiAHelJCL3YzM6ICZpJye.9JiN1IzUIJiOicGbhJCLiQ1VKJiOiAXe0Jye"
-                   },
-         'quafudev': {'server': '120.46.209.71/qbackend',
-                      'token': "k1J_V8y_86aY_EH_Zvb-3MHkTSmihXrA92v4v7TpfvB.9lDN1kDN4UDO2EjOiAHelJCL3YzM6ICZpJye.9JiN1IzUIJiOicGbhJCLiQ1VKJiOiAXe0Jye"
-                      }
-         }
 
+import json
+from pathlib import Path
 
 try:
-    srv = sys.argv[1:][0]
-except Exception as e:
-    srv = 'quafu'
-
-try:
-    cloud = CLOUD[srv]
+    with open(Path.home()/'quark/startup.json', 'r') as f:
+        startup = json.loads(f.read())
 except Exception as e:
     print(e)
-
-
-# region cloud
-def get_date_range(start: str = '2023-05-18', end: str = '2023-05-25',
-                   days: int = 0, hours: int = 1, dfmt: str = "%Y-%m-%d-%H"):
-    dates = []
-    date = start
-    dt = datetime.datetime.strptime(start, dfmt)
-    while date <= end:
-        dates.append(date)
-        dt = dt+datetime.timedelta(days=days, hours=hours)
-        date = dt.strftime(dfmt)
-
-    return dates
-
-
-def plot_stat(dates: list[str], counts: list[int]):
-    import matplotlib.pyplot as plt
-    _x = [s[6:] for s in dates]
-    plt.bar(_x, counts, color='lightblue', edgecolor='k')
-    plt.plot(counts, '-go', lw=2)
-    plt.xticks(rotation=45)
-    plt.xlabel('Date')
-    plt.ylabel('Tasks/Day')
-    plt.grid()
-
-
-TABLE = string.digits+string.ascii_uppercase
-
-
-def basen(number: int, base: int, table: str = TABLE):
-    mods = []
-    while True:
-        div, mod = divmod(number, base)
-        mods.append(mod)
-        if div == 0:
-            mods.reverse()
-            return ''.join([table[i] for i in mods])
-        number = div
-
-
-def baser(number: str, base: int, table: str = TABLE):
-    return sum([table.index(c)*base**i for i, c in enumerate(reversed(number))])
-# endregion cloud
-
-
-# region performance
-def analyze(info: list[dict], start: int = 0):
-    ppl, dvm = {}, {}
-    for sid, record in enumerate(info):
-        for name in ['Cal', 'Dev', 'Dem']:
-            if name in ppl:
-                ppl[name].append(record['summary'][name])
-            else:
-                ppl[name] = [record['summary'][name]]
-
-        for step, device in record['details'].items():
-            for dev, val in device.items():
-                if val['actual'] <= 0.0:
-                    continue
-                key = f'{step}.{dev}'
-                if key in dvm:
-                    dvm[key].append(val['actual'])
-                else:
-                    dvm[key] = [val['actual']]
-    return ppl, dvm
-
-
-def barplot(ax, data: dict, width: float = 0.35, threshod: float = 0.0, title: str = 'Performance'):
-    for i, (k, v) in enumerate(data.items()):
-        if i == 0:
-            bottom = np.zeros(len(v))
-            ticks = list(range(len(v)))
-        value = np.asarray(v)
-        if value.max() >= threshod:
-            label = ax.bar(ticks, value, width, yerr=0.0,
-                           bottom=bottom, label=k)
-            bottom += value
-        else:
-            label = ''
-
-    ax.set_xlabel('Step')
-    ax.set_ylabel('Duration (s)')
-    ax.set_title(title)
-    ax.legend()
-# endregion performance
+    startup = {}
```

## vios/collection/__init__.py

```diff
@@ -1,29 +1,27 @@
-"""本模块主要由工具函数构成
->>> analyzer：数据分析
->>> experiment：实验描述
+"""本模块主要由工具函数构成, 且依赖server
+>>> tasks：实验描述
 >>> support：兼容层，如与Scanner格式转换
 >>> uapi：与前端进行交互，如matplotlib画图、数据库查询、实时画图等，详见各函数说明。
->>> utility：其他常用函数
 """
 import asyncio
 import json
+import os
 import time
 from collections import OrderedDict
 from functools import cached_property
 from pathlib import Path
 
+from kernel.sched import JupyterProgressBar, Progress
 from quark import connect
-from waveforms.systemq_kernel.kernel.sched import JupyterProgressBar, Progress
-
-etc = Path().home()/ '.systemq/bootstrap.json'
 
+from .. import startup
 
 try:
-    with open(etc, 'r') as f:
+    with open(Path(startup.get('site', '')) /'etc/bootstrap.json', 'r') as f:
         cfg = json.loads(f.read())['executor']
 except Exception as e:
     print(e)
     cfg = {"host": "127.0.0.1", "port": 2088}
 
 print(cfg)
 s = connect('QuarkServer', host=cfg.get('host', '0.0.0.0'), port=cfg.get('port',2088))
@@ -112,27 +110,32 @@
 
     def join(self):
         try:
             self.result()
         except Exception as e:
             print(e)
 
-        status = self.status()
-        self.progress.max = status['size']
+        try:
+            status = self.status()
+            self.progress.max = status['size']
+        except Exception as e:
+            print(e,status)
+            self.join()
+
         if status['status'] in ['Pending']:
             time.sleep(0.5)
             self.join()
         elif status['status'] in ['Failed', 'Canceled']:
             return self.stop(self.taskid, False)
         elif status['status'] in ['Running']:
             self.progress.goto(self.index)
         elif status['status'] in ['Finished', 'Archived']:
             self.progress.goto(self.progress.max)
 
-        if self.index and self.index == self.progress.max:
+        # if self.index and self.index == self.progress.max:
             return self.stop(self.taskid)
         
         if isinstance(self.timeout, float):
             if self.timeout > 0 and (time.time() - self.stime > self.timeout):
                 msg = f'Timeout: {self.timeout}'
                 print(msg)
                 raise TimeoutError(msg)
```

## vios/collection/support.py

```diff
@@ -1,20 +1,19 @@
 from pprint import pprint
 
 import pandas as pd
 
 try:
-    from vios.collection import server as s
+    from vios.collection import s
 except Exception as e:
     print(e)
     raise e
 
-from waveforms.scan_iter import scan_iters
-
 from qos_tools.experiment.scanner2 import Scanner
+from waveforms.scan_iter import scan_iters
 
 # Task模板，由用户自行生成
 TEMPLATE = {
     'name': 'S21', # 任务名
     'signal': 'iq',
     'shots': 1024,
```

## vios/collection/uapi.py

```diff
@@ -127,15 +127,15 @@
     Args:
         tid (int): 任务id
 
     Returns:
         tuple: 任务描述信息、数据体、数据记录名
     """
     filename, dataset = s.track(tid)['file'].rsplit(':', 1)
-    cfg, keys = s.load(filename, dataset)
+    keys, cfg  = s.load(filename, dataset)
     data = s.load(filename, f'{dataset}/{keys[0]}') if keys else None
     return loads(cfg['snapshot']), data
 
 
 def vplot():
     lines = []
     try:
@@ -154,24 +154,24 @@
         if not vdict:
             step = 0
         elif p['step'] >= 0:
             step = p['step']
         else:
             step = 0
 
-        cmds = s.review(p['tid'], step, raw=False)
+        cmds = s.review(p['tid'], step, key='raw')
         try:
             cmds = cmds['WRITE']
         except Exception as e:
             cmds = cmds['main']
 
         for i, (target, (ctype, value, units, kwds)) in enumerate(cmds.items()):
             if isinstance(value, Waveform):
                 name = kwds['target']
-                wlen = 5e-6
+                wlen = 100e-6
                 t = np.linspace(0, wlen, int(wlen*value.sample_rate))
                 if name not in vdict:
                     LASTID['index'] += 1
                     vdict[name] = {'index': LASTID['index'],
                                    'color': colors.to_rgb(_colors[LASTID['index']+10])}
 
                 wf = value(t)-vdict[name]['index']*2
```

## vios/driver/common/__init__.py

```diff
@@ -1,5 +1,4 @@
 from .basedriver import BaseDriver
 from .quantity import (QBool, QInteger, QList, QOption, QReal, QString,
                        Quantity, QVector)
-from .utils import get_coef
 from .visadriver import IEEE_488_2_BinBlock, VisaDriver
```

## vios/envelope/__init__.py

```diff
@@ -1,24 +1,16 @@
-"""本模块为实验中需由用户实现的部分构成。模块调用所需参数见各自模块的说明文档。
-每个实验Step依次流经以下环节即执行完毕。实验者可以自行定各环节行为，即
+"""本模块为实验中可由用户实现的部分构成。模块调用所需参数见各自模块的说明文档。
+每个实验Step的执行依次流经以下环节(@标注，&表示相应环节所执行方法，箭头表示执行顺序)。
 
-@compiler       -->   @rule           -->   @calculator       -->   @device          -->   @demodulator
-    |           |       |             |          |            |        |             |          |
-    &ccompile -->       &decode       |          &calculate   |        &read|write -->          &process
-                        |             |          |            |
-                        &preprocess -->          &calibrate   | 
-                                                 |            |
-                                                 &crosstalk --> 
-
->>> 线路编绎：compiler.ccompile，编绎Step中的线路生成对应操作的波形。核心功能由HKXu提供
->>> 指令规则：rule.decode--->preprocess，通道规则，如通道如何映射、多个波形共用一个通道时如何处理
->>> 指令处理：calculator.calculate--->calibrate--->crosstalk，包括采样、失真、串扰、校准等操作
->>> 设备读写：device.read|write，将处理后的指令送入设备执行
->>> 数据处理：demodulator.process--->postprocess，将从设备得到的结果进行解调等处理。最终数据处理由postprocess定义
+--->@assembler      @calculator       @device          @processor       @rule
+        ↓           ↑    ↓            ↑  ↓             ↑     ↓          ↑   ↓ 
+        &ccompile   ↑    &calculate -->  &read|write -->     &process -->   &postprocess --->
+        ↓           ↑
+        &assemble -->
 """
 
 
-from .calculator import calculate, calibrate, crosstalk
-from .compiler import QuarkLocalConfig, ccompile
-from .demodulator import postprocess, process
+from .assembler import MAPPING, assemble, ccompile, decode, initialize
+from .calculator import calculate
 from .device import read, write
-from .rule import MAPPING, decode, preprocess
+from .processor import process
+from .rule import postprocess
```

## vios/envelope/calculator.py

```diff
@@ -139,15 +139,15 @@
         func = func >> delay
         func.start = 0
         func.stop = kwds['LEN']
         func.sample_rate = kwds['srate']
         func.bounds = tuple(np.round(func.bounds, 18))
 
         # if support_waveform(target):
-        if target.startswith(tuple(kwds.get('filter',['']))):  # etc.filter
+        if target.startswith(tuple(kwds.get('filter',['zzzzz']))):  # etc.filter
 
             cmd[1] = func
             # if target in ['QC_T1_C7.waveform.Z', 'LH_141_AWG_Slot2.CH1.Waveform']:
             #     print('\n\n\n\n', func.tolist(), '\n\n\n\n')
             return (step, target, cmd)
 
         cmd[1] = func.sample()
```

## vios/envelope/rule.py

```diff
@@ -1,112 +1,97 @@
-"""设备逻辑预处理，数据后处理
+"""任务结束之后对结果进行后处理
 """
-# 设备通道与config表中字段的映射关系
-MAPPING = {
-    "setting_LO": "LO.Frequency",
-    "setting_POW": "LO.Power",
-    "setting_OFFSET": "ZBIAS.Offset",
-    "waveform_RF_I": "I.Waveform",
-    "waveform_RF_Q": "Q.Waveform",
-    "waveform_TRIG": "TRIG.Marker1",
-    "waveform_SW": "SW.Marker1",
-    "waveform_Z": "Z.Waveform",
-    "setting_PNT": "ADC.PointNumber",
-    "setting_SHOT": "ADC.Shot",
-    "setting_TRIGD": "ADC.TriggerDelay"
-}
 
+import json
+import time
+from pathlib import Path
 
-suffix = ('Waveform', 'Shot', 'Coefficient', 'TriggerDelay')
+import numpy as np
+import requests
 
+from .. import startup
 
-def decode(target: str, context: dict, mapping: dict = MAPPING):
-    """Qubit等属性与硬件通道之间的映射转换
+try:
+    with open(Path(startup.get('site', ''))/'etc/cloud.json', 'r') as f:
+        CLOUD = json.loads(f.read())
+except Exception as e:
+    print(e)
+    CLOUD = {}
 
-    Args:
-        target (str): 待解析对象，如Q0.setting.LO
-        context (dict): 对象所在cfg的字段
-        mapping (dict, optional): 通道和硬件属性的映射关系. Defaults to MAPPING.
-
-    Raises:
-        KeyError: 通道映射不存在
-        ValueError: 通道不存在
-
-    Returns:
-        str: 通道，如AD.CH1.TraceIQ
-    """
-    try:
-        mkey = target.split('.', 1)[-1].replace('.', '_')
-        chkey, quantity = mapping[mkey].split('.', 1)
-    except KeyError as e:
-        raise KeyError(f'{e} not found in mapping!')
-
-    try:
-        channel = context.get('channel', {})[chkey]
-    except KeyError as e:
-        raise KeyError(f'{chkey} not found!')
-
-    if channel is None:
-        raise ValueError('ChannelNotFound')
-    elif 'Marker' not in channel:
-        channel = '.'.join((channel, quantity))
-
-    return channel
 
-
-def merge(context: dict, cached: dict = {'Q0101.calibration.Z.delay': 12345}):
-    """合并指令执行上下文环境，如将{'Q0101.calibration.z.delay':12345}合并至Q0101
-    context['target']: 如Q010.waveform.Z，根据Q0101来判断合并cached中的哪个字段
-
-    Args:
-        context (dict): 从cfg表中获取，即Qubit、Coupler等字段
-        cached (dict): 无实际通道的指令缓存，形如{'Q0101.calibration.z.delay':12345}
-    """
-    for ck, cv in cached.items():
-        node, path = ck.split('.', 1)
-        if context['target'].startswith(node):
-            for k in path.split('.'):
-                dk = context.get(k, {})
-                if isinstance(dk, dict):
-                    context = dk
-                    continue
-                context[k] = cv
-
-
-def preprocess(target: str, cmd: list, cache: dict, bypass: dict = {}):
-    """设备逻辑预处理（如相同通道写多个波形等），处理完毕送往calculator进行采样等计算。
+def postprocess(result: dict):
+    """任务执行完后对数据的操作，如存储到自定义路径或回传到云平台等
 
     Args:
-        target (str): 设备通道，如AWG.CH1.Waveform
-        cmd (list): 待执行指令，格式为(READ|WRITE,value,unit,kwds)。其中kwds为
-                    {'target':'原始指令如Q0101.waveform.Z', 
-                     'filter':calculator中波形是否采样列表,
-                     'srate':'对应设备采样率',
-                     'context':'cfg表中字段，如Q0101', 
-                     'cached':'无实际通道指令，详见merge函数'}
-        cache (dict): 已缓存指令，格式为{target: cmd}
-        bypass (dict): 缓存重复指令以避免重复设置
+        result (dict): 任务结果，包含数据段和基本描述信息
     """
-    kwds = cmd[-1]
-
-    # 重复指令缓存
-    if target in bypass and target.endswith(suffix) and bypass[target][0] == cmd[1]:
-        return cache
-    bypass[target] = (cmd[1], kwds['target'])
-
-    # context设置，用于calculator.calculate
-    context = kwds.pop('context', {})  # 即Qubit、Coupler等
-    if context:
-        kwds['LEN'] = context['waveform']['LEN']
-        kwds['calibration'] = context['calibration']
-        merge(context=kwds, cached=kwds.pop('cached', {}))
-
-    # 波形采样率设置
-    if target.endswith('Waveform') and type(cmd[1]).__name__ == 'Waveform':
-        cmd[1].sample_rate = kwds['srate']
-
-    # 处理多通道共用逻辑
-    if target in cache and target.endswith('Waveform'):
-        cache[target][1] += cmd[1]
-    else:
-        cache[target] = cmd
-    return cache
+    def _delete_dict(ret: dict, num: int = 0):
+        while num > 0:
+            tmp = np.cumsum(list(ret.values()))
+            ran_num = np.random.randint(tmp[-1]+1)
+            ran_pos = np.searchsorted(tmp, ran_num)
+            ret[list(ret.keys())[ran_pos]] -= 1
+            if ret[list(ret.keys())[ran_pos]] == 0:
+                ret.pop(list(ret.keys())[ran_pos], 0)
+            num -= 1
+
+    # print(result.keys(),result['meta'].keys())
+
+    meta = result['meta']
+    print('Send result back  to', meta['user'])
+    if not meta['user'].startswith('quafu'):
+        return
+    
+    if not CLOUD:
+        return
+    
+    srv = CLOUD[meta['user']]
+
+    task_id = hex(meta['tid'])[2:].upper()
+    task_status = 'failed'
+    if meta['status'] in ['Finished','Archived']:
+        task_status = 'finished'
+        try:
+            data: list[dict] = result['data']['count']
+        except Exception as e:
+            print('Failed to process result',e)
+            task_status = 'failed'
+    
+    if task_status == 'finished':
+        dres = {}
+        for dat in data:
+            for k, v in dat.items():
+                dres[k] = dres.get(k, 0)+v
+
+        try:
+            shots = meta['other']['shots']*len(meta['axis']['repeat']['repeat'])
+            _delete_dict(dres, shots - (shots//1000)*1000)
+        except Exception as e:
+            print('Failed to dropout', e)
+
+        dic_res = {}
+        for k, v in dres.items():
+            dic_res[''.join((str(i) for i in k))] = v
+
+        rshot = sum(dic_res.values())
+
+        post_data = {"task_id": task_id,
+                     "status": task_status,
+                     "raw": str(dic_res).replace("\'", "\""),
+                     "res": str(dic_res).replace("\'", "\""),
+                     "server": 2}
+
+    elif task_status == 'failed':
+        rshot = 0
+        post_data = {"task_id": task_id,
+                     "status": task_status,
+                     "raw": "",
+                     "res": "",
+                     "server": 2}
+    # print(post_data)
+    try:
+        resp = requests.post(url=f"http://{srv['server']}/scq_result/",
+                             data=post_data,
+                             headers={'api_token': srv['token']})
+        print(time.strftime('%Y-%m-%d %H:%M:%S'), resp.text, rshot)
+    except:
+        print('POST ERROR')
```

## Comparing `vios/collection/experiment.py` & `vios/collection/tasks.py`

 * *Files identical despite different names*

## Comparing `vios-1.0.1.dist-info/LICENSE` & `vios-1.0.2.dist-info/LICENSE`

 * *Files identical despite different names*

## Comparing `vios-1.0.1.dist-info/METADATA` & `vios-1.0.2.dist-info/METADATA`

 * *Files 2% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: vios
-Version: 1.0.1
+Version: 1.0.2
 Summary: runtime requirements for systemq
 Author-email: YL <fengyl@baqis.ac.cn>
 Project-URL: homepage, https://gitee.com
 Project-URL: bugs, https://gitee.com
 Classifier: Development Status :: 5 - Production/Stable
 Classifier: Intended Audience :: Developers
 Classifier: Intended Audience :: Science/Research
@@ -15,16 +15,16 @@
 Classifier: Operating System :: POSIX :: Linux
 Classifier: Operating System :: MacOS :: MacOS X
 Classifier: Programming Language :: Python :: 3.10
 Classifier: Topic :: Scientific/Engineering :: Physics
 Requires-Python: >=3.10
 Description-Content-Type: text/markdown
 License-File: LICENSE
-Requires-Dist: quarkstudio[full] (>=6.5.0rc13)
-Requires-Dist: waveforms (>=1.6.0)
+Requires-Dist: quarkstudio[full] (>=6.5.0rc15)
+Requires-Dist: waveforms
 Requires-Dist: pyvisa
 Requires-Dist: blinker
 
 ...
```

